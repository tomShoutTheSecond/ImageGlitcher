{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\Tom\\\\Documents\\\\Repos\\\\ImageGlitcher\\\\image-glitcher\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Tom\\\\Documents\\\\Repos\\\\ImageGlitcher\\\\image-glitcher\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _createSuper from\"C:\\\\Users\\\\Tom\\\\Documents\\\\Repos\\\\ImageGlitcher\\\\image-glitcher\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _inherits from\"C:\\\\Users\\\\Tom\\\\Documents\\\\Repos\\\\ImageGlitcher\\\\image-glitcher\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import{State}from'./App';import{Colors}from'./Colors';import{Styles}from'./Styles';import{Util}from'./Util';import{FramePreview}from'./FramePreview';export var ImageProcessor=/*#__PURE__*/function(_React$Component){_inherits(ImageProcessor,_React$Component);var _super=_createSuper(ImageProcessor);function ImageProcessor(){var _this;_classCallCheck(this,ImageProcessor);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={previewUrl:\"\"};return _this;}_createClass(ImageProcessor,[{key:\"render\",value:function render(){var _this2=this;var containerStyle={margin:\"16px\",padding:\"16px\",verticalAlign:\"top\",background:Colors.background,borderWidth:1,borderStyle:\"solid\",borderColor:Colors.border,display:\"inline-block\"};var bigButtonStyle={color:Colors.accent,background:Colors.fill,border:\"none\",fontSize:\"16px\",padding:\"16px\",float:\"right\"};return/*#__PURE__*/React.createElement(\"div\",{style:containerStyle},/*#__PURE__*/React.createElement(\"h1\",{style:Styles.h1Style},\"Process Image\"),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"frames\"},\"Frames\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"frames\",ref:\"framesInput\",type:\"number\",defaultValue:\"1\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"boomerang\"},\"Boomerang\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"boomerang\",ref:\"boomerangInput\",type:\"checkbox\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"encoding\"},\"Encoding algorithm \"),/*#__PURE__*/React.createElement(\"select\",{id:\"encoding\",ref:\"encodingInput\"},/*#__PURE__*/React.createElement(\"option\",{value:\"mulaw\"},\"\\u03BC-law\"),/*#__PURE__*/React.createElement(\"option\",{value:\"alaw\"},\"a-law\")),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"h2\",{style:Styles.h2Style},\"Amplitude Modulation\"),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"startFreq\"},\"Start Frequency\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"startFreq\",ref:\"startFreqInput\",type:\"number\",defaultValue:\"0.01\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"endFreq\"},\"End Frequency\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"endFreq\",ref:\"endFreqInput\",type:\"number\",defaultValue:\"0.01\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"startPhase\"},\"Start Phase\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"startPhase\",ref:\"startPhaseInput\",type:\"number\",defaultValue:\"0\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"endPhase\"},\"End Phase\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"endPhase\",ref:\"endPhaseInput\",type:\"number\",defaultValue:\"0\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"startAmp\"},\"Start Amp\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"startAmp\",ref:\"startAmpInput\",type:\"number\",defaultValue:\"1\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"endAmp\"},\"End Amp\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"endAmp\",ref:\"endAmpInput\",type:\"number\",defaultValue:\"1\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"startOffset\"},\"Start DC Offset\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"startOffset\",ref:\"startOffsetInput\",type:\"number\",defaultValue:\"1\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"endOffset\"},\"End DC Offset\"),\" \",/*#__PURE__*/React.createElement(\"input\",{id:\"endOffset\",ref:\"endOffsetInput\",type:\"number\",defaultValue:\"1\"}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{style:bigButtonStyle,onClick:function onClick(){return _this2.prepareToProcessAnimation();}},\"Process\"));}},{key:\"prepareToProcessAnimation\",value:function prepareToProcessAnimation(){var _this3=this;//clear downloads area\nState.clearDownloads();State.setFrameLoadingState(true);//wait to let renderer catch up\nvar waitTime=200;setTimeout(function(){return _this3.processAnimation();},waitTime);}},{key:\"processAnimation\",value:function processAnimation(){var framesInput=this.refs.framesInput;var frames=parseInt(framesInput.value);var boomerangInput=this.refs.boomerangInput;var boomerang=boomerangInput.checked;var startFreqInput=this.refs.startFreqInput;var endFreqInput=this.refs.endFreqInput;var startPhaseInput=this.refs.startPhaseInput;var endPhaseInput=this.refs.endPhaseInput;var startAmpInput=this.refs.startAmpInput;var endAmpInput=this.refs.endAmpInput;var startOffsetInput=this.refs.startOffsetInput;var endOffsetInput=this.refs.endOffsetInput;var startFreq=parseFloat(startFreqInput.value);var endFreq=parseFloat(endFreqInput.value);var startPhase=parseFloat(startPhaseInput.value);var endPhase=parseFloat(endPhaseInput.value);var startAmp=parseFloat(startAmpInput.value);var endAmp=parseFloat(endAmpInput.value);var startOffset=parseFloat(startOffsetInput.value);var endOffset=parseFloat(endOffsetInput.value);for(var i=0;i<frames;i++){var progress=i/frames;var frameFrequency=Util.mixNumber(startFreq,endFreq,progress);var framePhase=Util.mixNumber(startPhase,endPhase,progress);var frameAmp=Util.mixNumber(startAmp,endAmp,progress);var frameOffset=Util.mixNumber(startOffset,endOffset,progress);this.processFrame(frameFrequency,framePhase,frameAmp,frameOffset);}if(boomerang){for(var _i=0;_i<frames;_i++){var _progress=1-_i/frames;var _frameFrequency=Util.mixNumber(startFreq,endFreq,_progress);var _framePhase=Util.mixNumber(startPhase,endPhase,_progress);var _frameAmp=Util.mixNumber(startAmp,endAmp,_progress);var _frameOffset=Util.mixNumber(startOffset,endOffset,_progress);this.processFrame(_frameFrequency,_framePhase,_frameAmp,_frameOffset);}}State.setFrameLoadingState(false);//create animation (once image previews are loaded)\nvar waitTime=1000;setTimeout(function(){var _FramePreview$instanc;return(_FramePreview$instanc=FramePreview.instance)===null||_FramePreview$instanc===void 0?void 0:_FramePreview$instanc.createGif();},waitTime);}},{key:\"processFrame\",value:function processFrame(frequency,phase,amp,offset){//get data from file\nvar rawData=this.props.imageData;//decode data\nvar decodedFile=this.decodeFile(rawData);//process data\nvar processedData=this.bufferProcess(decodedFile,frequency,phase,amp,offset);//encode data\nvar encodedFile=this.encodeFile(processedData);this.saveByteArray(encodedFile);}},{key:\"encodeFile\",value:function encodeFile(rawData){var encodingInput=this.refs.encodingInput;var encodingAlgorithm=encodingInput.value;//@ts-ignore\nreturn encodingAlgorithm===\"mulaw\"?alawmulaw.mulaw.encode(rawData):alawmulaw.alaw.encode(rawData);}},{key:\"decodeFile\",value:function decodeFile(rawData){var encodingInput=this.refs.encodingInput;var encodingAlgorithm=encodingInput.value;//@ts-ignore\nreturn encodingAlgorithm===\"mulaw\"?alawmulaw.mulaw.decode(rawData):alawmulaw.alaw.decode(rawData);}},{key:\"bufferProcess\",value:function bufferProcess(buffer,frequency,phase,amp,offset){var headerLength=54;var processedBuffer=[];for(var i=0;i<buffer.length;i++){var sample=buffer[i];if(i<headerLength){processedBuffer.push(sample);continue;}var angle=phase+i*frequency;var coef=offset+Math.sin(angle)*amp;var processedSample=sample*coef;processedBuffer.push(processedSample);}return processedBuffer;}},{key:\"saveByteArray\",value:function saveByteArray(data){var blob=new Blob([data],{type:\"image/bmp\"});var url=window.URL.createObjectURL(blob);State.addDownload(url);}}]);return ImageProcessor;}(React.Component);","map":{"version":3,"sources":["C:/Users/Tom/Documents/Repos/ImageGlitcher/image-glitcher/src/ImageProcessor.tsx"],"names":["React","State","Colors","Styles","Util","FramePreview","ImageProcessor","state","previewUrl","containerStyle","margin","padding","verticalAlign","background","borderWidth","borderStyle","borderColor","border","display","bigButtonStyle","color","accent","fill","fontSize","float","h1Style","h2Style","prepareToProcessAnimation","clearDownloads","setFrameLoadingState","waitTime","setTimeout","processAnimation","framesInput","refs","frames","parseInt","value","boomerangInput","boomerang","checked","startFreqInput","endFreqInput","startPhaseInput","endPhaseInput","startAmpInput","endAmpInput","startOffsetInput","endOffsetInput","startFreq","parseFloat","endFreq","startPhase","endPhase","startAmp","endAmp","startOffset","endOffset","i","progress","frameFrequency","mixNumber","framePhase","frameAmp","frameOffset","processFrame","instance","createGif","frequency","phase","amp","offset","rawData","props","imageData","decodedFile","decodeFile","processedData","bufferProcess","encodedFile","encodeFile","saveByteArray","encodingInput","encodingAlgorithm","alawmulaw","mulaw","encode","alaw","decode","buffer","headerLength","processedBuffer","length","sample","push","angle","coef","Math","sin","processedSample","data","blob","Blob","type","url","window","URL","createObjectURL","addDownload","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { State } from './App';\r\nimport { Colors } from './Colors';\r\nimport { Styles } from './Styles';\r\nimport { Util } from './Util';\r\nimport { FramePreview } from './FramePreview';\r\n\r\ninterface ImageProcessorProps\r\n{\r\n    imageData : Uint8Array\r\n}\r\n\r\nexport class ImageProcessor extends React.Component<ImageProcessorProps>\r\n{\r\n    state = { previewUrl: \"\" };\r\n\r\n    render()\r\n    {\r\n        let containerStyle : React.CSSProperties = \r\n        {\r\n            margin: \"16px\",\r\n            padding: \"16px\",\r\n            verticalAlign: \"top\",\r\n            background: Colors.background,\r\n            borderWidth: 1,\r\n            borderStyle: \"solid\",\r\n            borderColor: Colors.border,\r\n            display: \"inline-block\"\r\n        };\r\n\r\n        let bigButtonStyle : React.CSSProperties = \r\n        {\r\n            color: Colors.accent,\r\n            background: Colors.fill,\r\n            border: \"none\",\r\n            fontSize: \"16px\",\r\n            padding: \"16px\",\r\n            float: \"right\"\r\n        };\r\n\r\n        return (\r\n            <div style={containerStyle}>\r\n                <h1 style={Styles.h1Style}>Process Image</h1>\r\n                <label htmlFor=\"frames\">Frames</label> <input id=\"frames\" ref=\"framesInput\" type=\"number\" defaultValue=\"1\"/>\r\n                <br />\r\n                <br />\r\n                <label htmlFor=\"boomerang\">Boomerang</label> <input id=\"boomerang\" ref=\"boomerangInput\" type=\"checkbox\"/>\r\n                <br />\r\n                <br />\r\n                <label htmlFor=\"encoding\">Encoding algorithm </label>\r\n                <select id=\"encoding\" ref=\"encodingInput\">\r\n                    <option value=\"mulaw\">μ-law</option>\r\n                    <option value=\"alaw\">a-law</option>\r\n                </select>\r\n                <br />\r\n                <br />\r\n                <h2 style={Styles.h2Style}>Amplitude Modulation</h2>\r\n                <label htmlFor=\"startFreq\">Start Frequency</label> <input id=\"startFreq\" ref=\"startFreqInput\" type=\"number\" defaultValue=\"0.01\"/>\r\n                <br />\r\n                <label htmlFor=\"endFreq\">End Frequency</label> <input id=\"endFreq\" ref=\"endFreqInput\" type=\"number\" defaultValue=\"0.01\"/>\r\n                <br />\r\n                <br />\r\n                <label htmlFor=\"startPhase\">Start Phase</label> <input id=\"startPhase\" ref=\"startPhaseInput\" type=\"number\" defaultValue=\"0\"/>\r\n                <br />\r\n                <label htmlFor=\"endPhase\">End Phase</label> <input id=\"endPhase\" ref=\"endPhaseInput\" type=\"number\" defaultValue=\"0\"/>\r\n                <br />\r\n                <br />\r\n                <label htmlFor=\"startAmp\">Start Amp</label> <input id=\"startAmp\" ref=\"startAmpInput\" type=\"number\" defaultValue=\"1\"/>\r\n                <br />\r\n                <label htmlFor=\"endAmp\">End Amp</label> <input id=\"endAmp\" ref=\"endAmpInput\" type=\"number\" defaultValue=\"1\"/>\r\n                <br />\r\n                <br />\r\n                <label htmlFor=\"startOffset\">Start DC Offset</label> <input id=\"startOffset\" ref=\"startOffsetInput\" type=\"number\" defaultValue=\"1\"/>\r\n                <br />\r\n                <label htmlFor=\"endOffset\">End DC Offset</label> <input id=\"endOffset\" ref=\"endOffsetInput\" type=\"number\" defaultValue=\"1\"/>\r\n                <br />\r\n                <br />\r\n                <button style={bigButtonStyle} onClick={() => this.prepareToProcessAnimation()}>Process</button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    prepareToProcessAnimation()\r\n    {\r\n        //clear downloads area\r\n        State.clearDownloads();\r\n        State.setFrameLoadingState(true);\r\n\r\n        //wait to let renderer catch up\r\n        let waitTime = 200;\r\n        setTimeout(() => this.processAnimation(), waitTime);\r\n    }\r\n\r\n    processAnimation()\r\n    {\r\n        let framesInput = this.refs.framesInput as HTMLInputElement;\r\n        let frames = parseInt(framesInput.value);\r\n\r\n        let boomerangInput = this.refs.boomerangInput as HTMLInputElement;\r\n        let boomerang = boomerangInput.checked;\r\n\r\n        let startFreqInput = this.refs.startFreqInput as HTMLInputElement;\r\n        let endFreqInput = this.refs.endFreqInput as HTMLInputElement;\r\n        let startPhaseInput = this.refs.startPhaseInput as HTMLInputElement;\r\n        let endPhaseInput = this.refs.endPhaseInput as HTMLInputElement;\r\n        let startAmpInput = this.refs.startAmpInput as HTMLInputElement;\r\n        let endAmpInput = this.refs.endAmpInput as HTMLInputElement;\r\n        let startOffsetInput = this.refs.startOffsetInput as HTMLInputElement;\r\n        let endOffsetInput = this.refs.endOffsetInput as HTMLInputElement;\r\n\r\n        let startFreq = parseFloat(startFreqInput.value);\r\n        let endFreq = parseFloat(endFreqInput.value);\r\n        let startPhase = parseFloat(startPhaseInput.value);\r\n        let endPhase = parseFloat(endPhaseInput.value);\r\n        let startAmp = parseFloat(startAmpInput.value);\r\n        let endAmp = parseFloat(endAmpInput.value);\r\n        let startOffset = parseFloat(startOffsetInput.value);\r\n        let endOffset = parseFloat(endOffsetInput.value);\r\n\r\n        for (let i = 0; i < frames; i++) \r\n        {\r\n            let progress = i / frames;\r\n            let frameFrequency = Util.mixNumber(startFreq, endFreq, progress);\r\n            let framePhase = Util.mixNumber(startPhase, endPhase, progress);\r\n            let frameAmp = Util.mixNumber(startAmp, endAmp, progress);\r\n            let frameOffset = Util.mixNumber(startOffset, endOffset, progress);\r\n\r\n            this.processFrame(frameFrequency, framePhase, frameAmp, frameOffset);\r\n        }\r\n\r\n        if(boomerang)\r\n        {\r\n            for (let i = 0; i < frames; i++) \r\n            {\r\n                let progress = 1 - (i / frames);\r\n                let frameFrequency = Util.mixNumber(startFreq, endFreq, progress);\r\n                let framePhase = Util.mixNumber(startPhase, endPhase, progress);\r\n                let frameAmp = Util.mixNumber(startAmp, endAmp, progress);\r\n                let frameOffset = Util.mixNumber(startOffset, endOffset, progress);\r\n\r\n                this.processFrame(frameFrequency, framePhase, frameAmp, frameOffset);\r\n            }\r\n        }\r\n\r\n        State.setFrameLoadingState(false);\r\n\r\n        //create animation (once image previews are loaded)\r\n        let waitTime = 1000;\r\n        setTimeout(() => FramePreview.instance?.createGif(), waitTime);\r\n    }\r\n\r\n    processFrame(frequency : number, phase : number, amp : number, offset : number)\r\n    {\r\n        //get data from file\r\n        let rawData = this.props.imageData;\r\n        \r\n        //decode data\r\n        let decodedFile = this.decodeFile(rawData);\r\n\r\n        //process data\r\n        let processedData = this.bufferProcess(decodedFile, frequency, phase, amp, offset);\r\n\r\n        //encode data\r\n        let encodedFile = this.encodeFile(processedData);\r\n        \r\n        this.saveByteArray(encodedFile);\r\n    }\r\n\r\n    encodeFile(rawData : number[])\r\n    {\r\n        let encodingInput = this.refs.encodingInput as HTMLInputElement;\r\n        let encodingAlgorithm = encodingInput.value;\r\n\r\n        //@ts-ignore\r\n        return encodingAlgorithm === \"mulaw\" ? alawmulaw.mulaw.encode(rawData) : alawmulaw.alaw.encode(rawData);\r\n    }\r\n\r\n    decodeFile(rawData : Uint8Array)\r\n    {\r\n        let encodingInput = this.refs.encodingInput as HTMLInputElement;\r\n        let encodingAlgorithm = encodingInput.value;\r\n\r\n        //@ts-ignore\r\n        return encodingAlgorithm === \"mulaw\" ? alawmulaw.mulaw.decode(rawData) : alawmulaw.alaw.decode(rawData);\r\n    }\r\n\r\n    bufferProcess(buffer : any, frequency : number, phase : number, amp : number, offset : number)\r\n    {\r\n        let headerLength = 54;\r\n\r\n        let processedBuffer = [];\r\n        for (let i = 0; i < buffer.length; i++) \r\n        {\r\n            const sample = buffer[i];\r\n\r\n            if(i < headerLength)\r\n            {\r\n                processedBuffer.push(sample);\r\n                continue;\r\n            }\r\n\r\n            let angle = phase + i * frequency;\r\n            let coef = offset + Math.sin(angle) * amp;\r\n\r\n            let processedSample = sample * coef;\r\n            processedBuffer.push(processedSample);\r\n        }\r\n\r\n        return processedBuffer;\r\n    }\r\n\r\n    saveByteArray(data : any)\r\n    {\r\n        let blob = new Blob([data], {type: \"image/bmp\"});\r\n        let url = window.URL.createObjectURL(blob);\r\n\r\n        State.addDownload(url);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}